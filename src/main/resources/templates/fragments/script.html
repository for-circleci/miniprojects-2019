<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js"
        integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl"
        crossorigin="anonymous"></script>
<script>
    window.onload = function () {
        document.querySelector('.search-toggle').addEventListener('click', toggleSearchInput)
        document.querySelector(".search-input input").addEventListener("keyup", showSearchedList)

        function toggleSearchInput(event) {
            event.preventDefault();
            document.querySelector('.search-box').classList.toggle('active');
            document.querySelector(".search-input").classList.toggle("active");
            document.querySelector(".search-input input").focus()
        }

        function showSearchedList(event) {
            const query = event.target.value;
            if (query.length > 0) {
                document.querySelector(".advanced-search").classList.add("active");
                fetch('/api/hashTag?query=' + query, {
                    method: 'GET',
                }).then(response => {
                    if (response.status === 200) {
                        response.json()
                            .then(data => {
                                document.querySelector("#search-result").innerHTML = "";
                                data["hashTags"].forEach(hashTag => {
                                    const template =
                                        `<li class="search-result-item">
                                    <a href="" class="text-dark">${hashTag.keyword}</a>
                                </li>`;
                                    document.querySelector("#search-result").innerHTML += template;
                                });

                            });
                        return;
                    }
                    if (response.status === 400) {
                        throw response.json();
                    }
                }).catch(error => {
                    error.then(exception => {
                        alert(exception.message)
                    });
                });
            } else {
                document.querySelector(".advanced-search").classList.remove("active")
            }
        }
    };

    const hashTag = () => {
        const contents = Array.from(document.getElementsByClassName('contents'));
        const regex = new RegExp('#([0-9a-zA-Z가-힣_]{2,30})', 'g');

        contents.forEach( content => {
            const contentsHtml = content.innerHTML;

            let tag = contentsHtml.match(regex);
            tag.forEach(tag => {
                content.innerHTML = content.innerHTML.replace(tag, '<a href="">' + tag + '</a>')
            });
        });
    };

    window.addEventListener('DOMContentLoaded', hashTag)
</script>